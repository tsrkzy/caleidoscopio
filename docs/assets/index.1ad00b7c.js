var v=Object.defineProperty;var E=(s,e,t)=>e in s?v(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>(E(s,typeof e!="symbol"?e+"":e,t),t);const L=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}};L();let a;const b=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});b.decode();let m=null;function I(){return(m===null||m.buffer!==a.memory.buffer)&&(m=new Uint8Array(a.memory.buffer)),m}function p(s,e){return b.decode(I().subarray(s,s+e))}let w=null;function _(){return(w===null||w.buffer!==a.memory.buffer)&&(w=new Int32Array(a.memory.buffer)),w}Object.freeze({Dead:0,"0":"Dead",Alive:1,"1":"Alive"});class g{static __wrap(e){const t=Object.create(g.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();a.__wbg_universe_free(e)}static new(){const e=a.universe_new();return g.__wrap(e)}tick(){a.universe_tick(this.ptr)}render(){try{const i=a.__wbindgen_add_to_stack_pointer(-16);a.universe_render(i,this.ptr);var e=_()[i/4+0],t=_()[i/4+1];return p(e,t)}finally{a.__wbindgen_add_to_stack_pointer(16),a.__wbindgen_free(e,t)}}}async function x(s,e){if(typeof Response=="function"&&s instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(s,e)}catch(i){if(s.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await s.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(s,e);return t instanceof WebAssembly.Instance?{instance:t,module:s}:t}}async function y(s){typeof s=="undefined"&&(s=new URL("/caleidoscopio/assets/caleidoscopio_bg.16f5e625.wasm",self.location));const e={};e.wbg={},e.wbg.__wbindgen_throw=function(n,r){throw new Error(p(n,r))},(typeof s=="string"||typeof Request=="function"&&s instanceof Request||typeof URL=="function"&&s instanceof URL)&&(s=fetch(s));const{instance:t,module:i}=await x(await s,e);return a=t.exports,y.__wbindgen_wasm_module=i,a}class f{}d(f,"DEAD",0),d(f,"ALIVE",1);class B{constructor(){d(this,"width",0);d(this,"height",0);d(this,"cells",[]);const i=new Array(4096).fill(0).map((n,r)=>r%2===0||r%7===0?f.ALIVE:f.DEAD);this.width=64,this.height=64,this.cells=i}render(){let e="";const t=this.width;let i=0;for(let n=0;n<this.cells.length;n++)this.cells[n]===f.ALIVE?e+="\u25A0":e+="\u25A1",i++,i===t&&(e+=`
`,i=0);return e}getIndex(e,t){return e*this.width+t}liveNeighborCount(e,t){let i=0;const n=[-1,0,1];for(let r=0;r<n.length;r++){let o=n[r];for(let c=0;c<n.length;c++){let l=n[c];if(o===0&&l===0)continue;const u=(e+o)%this.height,h=(t+l)%this.width,A=this.getIndex(u,h);i+=this.cells[A]}}return i}tick(){const e=this.cells.slice(),{width:t,height:i,cells:n=[]}=this;for(let r=0;r<t;r++)for(let o=0;o<i;o++){const c=this.getIndex(o,r),l=n[c],u=this.liveNeighborCount(o,r);let h=f.DEAD;l===f.ALIVE?(u===2||u===3)&&(h=f.ALIVE):u===3&&(h=f.ALIVE),e[c]=h}this.cells=e}}document.addEventListener("DOMContentLoaded",async()=>{if(!y||typeof y!="function")throw new Error("cannot connect with wasm");await y();const s=document.getElementById("game_canvas"),e=g.new();document.getElementById("start_wasm").addEventListener("click",n,!1),document.getElementById("start_js").addEventListener("click",r,!1);function n(){o();const c=()=>{console.time("wasm"),s.textContent=e.render(),e.tick(),requestAnimationFrame(c),console.timeEnd("wasm")};requestAnimationFrame(c)}function r(){o();const c=new B,l=()=>{console.time("js"),s.textContent=c.render(),c.tick(),requestAnimationFrame(l),console.timeEnd("js")};requestAnimationFrame(l)}function o(){const c=document.getElementsByClassName("start_button");for(const l of c)l.setAttribute("disabled",!0)}});
